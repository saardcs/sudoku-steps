<!DOCTYPE html>
<html>
<head>
  <style>
    table {
      border-collapse: collapse;
      margin: 0 auto;
    }
    td {
      border: 1px solid #aaa;
      width: 50px;
      height: 50px;
      text-align: center;
    }
    input {
      width: 100%;
      height: 100%;
      text-align: center;
      font-size: 24px;
      border: none;
    }
    input[readonly] {
      background-color: #eee;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <table id="sudoku"></table>

  <script>
    let allowedDigit = null;
    let initialPuzzle = null;

    function createBoard(puzzle) {
      const table = document.getElementById("sudoku");
      table.innerHTML = "";
      for (let i = 0; i < 6; i++) {
        const row = table.insertRow();
        for (let j = 0; j < 6; j++) {
          const cell = row.insertCell();
          const input = document.createElement("input");
          input.id = `cell-${i}-${j}`;
          const val = puzzle[i][j];
          if (val !== 0) {
            input.value = val;
            input.readOnly = true;
          }
          input.addEventListener("input", () => {
            if (input.readOnly) return;
            const v = input.value.trim();
            if (v !== String(allowedDigit)) {
              input.value = "";
            }
            sendBoard();
          });
          cell.appendChild(input);
        }
      }
    }

    function getBoard() {
      const board = [];
      for (let i = 0; i < 6; i++) {
        const row = [];
        for (let j = 0; j < 6; j++) {
          const input = document.getElementById(`cell-${i}-${j}`);
          const val = parseInt(input.value) || 0;
          row.push(val);
        }
        board.push(row);
      }
      return board;
    }

    function sendBoard() {
      const board = getBoard();
      window.parent.postMessage({
        isStreamlitMessage: true,
        type: "streamlit:setComponentValue",
        value: board
      }, "*");
    }

    window.addEventListener("message", (event) => {
      const data = event.data;
      if (data.type === "streamlit:render") {
        allowedDigit = data.args.allowedDigit;
        initialPuzzle = data.args.initialPuzzle;
        createBoard(initialPuzzle);
        sendBoard();
        window.parent.postMessage({ isStreamlitMessage: true, type: "streamlit:componentReady", apiVersion: 1 }, "*");
        window.parent.postMessage({ isStreamlitMessage: true, type: "streamlit:setFrameHeight", height: document.documentElement.scrollHeight }, "*");
      }
    });
  </script>
</body>
</html>
